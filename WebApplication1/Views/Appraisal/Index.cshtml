@using WebApplication1.Models

@{
    ViewBag.Title = " Appraisal";
    ViewBag.Active = "APR";

    Account Account = (Session["user"] == null) ? null : (Account)Session["user"];
}
<div id="section-heading">
    <div>
        @if (Account != null && Account.Type == AccountType.DepartmentHead)
        {
            <h1 id="section-title">Appraisal Non-Supervisory</h1>
        }
        else
        {
            <h1 id="section-title">Appraisal Supervisory</h1>
        }
    </div>
</div>
<br />
<form>
    <div class="two-column-content">
        <div class="cluster">
            <p class="sub-title">Details</p>
            <select name="employee" class="full">
                <option value="-1" disabled selected>-- Select Employee to Evaluate --</option>
            </select>
            <textarea class="full" placeholder="Criteria" name="criteria"></textarea>
        </div>
        <div class="cluster">
            <p class="sub-title">Covered Period</p>
            <select id="month" name="month" class="full">
                <option value="-1">-- Select month --</option>
                <!-- JS generated -->
            </select>
            <select id="day" name="day" class="full">
                <option value="-1">-- Select day --</option>
                <!-- JS generated -->
            </select>
            <select id="year" name="year" class="full">
                <option value="-1">-- Select year --</option>
                <!-- JS generated -->
            </select>
        </div>
    </div>
    <br />
    <div class="info">
        <h2>
            Evaluation Criteria for Rank & file Personnel
        </h2>
        <p>
            This instrument is designed to evaluate the personnel with the rank & file position wherein whatever information
            obtained herein will serve as a basis for salary and position adjustment and will serve also as a fram of reference for
            improvement. On a 5-point-scale, the immediate superior of the personnel being evaluated will make an objective and frank assessment
            of the subordinate by selecting the appropriate number that corresponds to the following:
        </p>
    </div>
    <br />
    <div class="two-column-content">
        <div class="cluster">
            <p>1 - POOR</p>
            <p>2 - NEEDS IMPROVEMENT</p>
            <p>3 - FAIR</p>
        </div>
        <div class="cluster">
            <p>4 - GOOD</p>
            <p>5 - VERY GOOD</p>
        </div>
    </div>
    <table>
        <thead>
            <tr id="heading-row">
                <th>I. Technical Competence and Work Attitude (45%)</th>
                <th>Rating</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>
                    Dami ng trabahong inatas.
                </td>
                <td>
                    <select name="criteria-1">
                        <option value="1" disabled selected>--SELECT RATING--</option>
                        <option value="1">POOR</option>
                        <option value="2">NEEDS IMPROVEMENT</option>
                        <option value="3">FAIR</option>
                        <option value="4">GOOD</option>
                        <option value="5">VERY GOOD</option>
                    </select>
                </td>
            </tr>
            <tr>
                <td>
                    Kaldidad ng gawain.
                </td>
                <td>
                    <select name="criteria-1">
                        <option value="1" disabled selected>--SELECT RATING--</option>
                        <option value="1">POOR</option>
                        <option value="2">NEEDS IMPROVEMENT</option>
                        <option value="3">FAIR</option>
                        <option value="4">GOOD</option>
                        <option value="5">VERY GOOD</option>
                    </select>
                </td>
            </tr>
            <tr>
                <td>
                    Kakayahang matapos ng tama ang gawain sa pinakamabilis na oras.
                </td>
                <td>
                    <select name="criteria-1">
                        <option value="1" disabled selected>--SELECT RATING--</option>
                        <option value="1">POOR</option>
                        <option value="2">NEEDS IMPROVEMENT</option>
                        <option value="3">FAIR</option>
                        <option value="4">GOOD</option>
                        <option value="5">VERY GOOD</option>
                    </select>
                </td>
            </tr>
            <tr>
                <td>
                    Toleransya sa pagkakunsyami, kakayahang kumilos ng kalmado at may pasensya tuwing may problema
                    na nagangailangan ng kompromiso o pag-aalangan.
                </td>
                <td>
                    <select name="criteria-1">
                        <option value="1" disabled selected>--SELECT RATING--</option>
                        <option value="1">POOR</option>
                        <option value="2">NEEDS IMPROVEMENT</option>
                        <option value="3">FAIR</option>
                        <option value="4">GOOD</option>
                        <option value="5">VERY GOOD</option>
                    </select>
                </td>
            </tr>
            <tr>
                <td>
                    Bukas ang isip sapagtanggap ng mga bagong ideya, opinion sa mga ebidensya na nangangailangan
                    at tumatanggap ng pagpuna/suhestyon ng positibo at bukas sa kalooban.
                </td>
                <td>
                    <select name="criteria-1">
                        <option value="1" disabled selected>--SELECT RATING--</option>
                        <option value="1">POOR</option>
                        <option value="2">NEEDS IMPROVEMENT</option>
                        <option value="3">FAIR</option>
                        <option value="4">GOOD</option>
                        <option value="5">VERY GOOD</option>
                    </select>
                </td>
            </tr>
            <tr>
                <td>
                    Ibinabahagi ang kaalaman ng buong puso para sa ikabubuti ng kumpanya
                    partikular sa kagawaran kung saan siya kabilang.
                </td>
                <td>
                    <select name="criteria-1">
                        <option value="1" disabled selected>--SELECT RATING--</option>
                        <option value="1">POOR</option>
                        <option value="2">NEEDS IMPROVEMENT</option>
                        <option value="3">FAIR</option>
                        <option value="4">GOOD</option>
                        <option value="5">VERY GOOD</option>
                    </select>
                </td>
            </tr>
            <tr>
                <td>
                    Atentibo at marunong makinig.
                </td>
                <td>
                    <select name="criteria-1">
                        <option value="1" disabled selected>--SELECT RATING--</option>
                        <option value="1">POOR</option>
                        <option value="2">NEEDS IMPROVEMENT</option>
                        <option value="3">FAIR</option>
                        <option value="4">GOOD</option>
                        <option value="5">VERY GOOD</option>
                    </select>
                </td>
            </tr>
            <tr>
                <td>
                    Tumatanggap ng responsibilidad.
                </td>
                <td>
                    <select name="criteria-1">
                        <option value="1" disabled selected>--SELECT RATING--</option>
                        <option value="1">POOR</option>
                        <option value="2">NEEDS IMPROVEMENT</option>
                        <option value="3">FAIR</option>
                        <option value="4">GOOD</option>
                        <option value="5">VERY GOOD</option>
                    </select>
                </td>
            </tr>
            <tr>
                <td>
                    Delikado at may commitment; mataman at maingat sa paggawa
                </td>
                <td>
                    <select name="criteria-1">
                        <option value="1" disabled selected>--SELECT RATING--</option>
                        <option value="1">POOR</option>
                        <option value="2">NEEDS IMPROVEMENT</option>
                        <option value="3">FAIR</option>
                        <option value="4">GOOD</option>
                        <option value="5">VERY GOOD</option>
                    </select>
                </td>
            </tr>
        </tbody>
    </table>
    <br /><br />
    <table>
        <thead>
            <tr id="heading-row">
                <th>II. Interpersonal Skills (35%)</th>
                <th>Rating</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>
                    Pagpapaunlak na ibahagi ang propesyonal na talino at kakayahan sa mga kasama.
                </td>
                <td>
                    <select name="criteria-2">
                        <option value="1" disabled selected>--SELECT RATING--</option>
                        <option value="1">POOR</option>
                        <option value="2">NEEDS IMPROVEMENT</option>
                        <option value="3">FAIR</option>
                        <option value="4">GOOD</option>
                        <option value="5">VERY GOOD</option>
                    </select>
                </td>
            </tr>
            <tr>
                <td>
                    Magandang pakikisama at pagiging kawili-wili, sibil at totoo sa mga kasama.
                </td>
                <td>
                    <select name="criteria-2">
                        <option value="1" disabled selected>--SELECT RATING--</option>
                        <option value="1">POOR</option>
                        <option value="2">NEEDS IMPROVEMENT</option>
                        <option value="3">FAIR</option>
                        <option value="4">GOOD</option>
                        <option value="5">VERY GOOD</option>
                    </select>
                </td>
            </tr>
            <tr>
                <td>
                    Kakayahang maki adapt sa mga iba't ibang social o grupo na sitwasyon.
                </td>
                <td>
                    <select name="criteria-2">
                        <option value="1" disabled selected>--SELECT RATING--</option>
                        <option value="1">POOR</option>
                        <option value="2">NEEDS IMPROVEMENT</option>
                        <option value="3">FAIR</option>
                        <option value="4">GOOD</option>
                        <option value="5">VERY GOOD</option>
                    </select>
                </td>
            </tr>
            <tr>
                <td>
                    Marespeto, meron konsiderasyon at pang unawa sa nararamdaman ng iba.
                </td>
                <td>
                    <select name="criteria-2">
                        <option value="1" disabled selected>--SELECT RATING--</option>
                        <option value="1">POOR</option>
                        <option value="2">NEEDS IMPROVEMENT</option>
                        <option value="3">FAIR</option>
                        <option value="4">GOOD</option>
                        <option value="5">VERY GOOD</option>
                    </select>
                </td>
            </tr>
            <tr>
                <td>
                    Nalulungod sa mga magagandang Gawain at tagumpay ng mga katrabaho.
                </td>
                <td>
                    <select name="criteria-2">
                        <option value="1" disabled selected>--SELECT RATING--</option>
                        <option value="1">POOR</option>
                        <option value="2">NEEDS IMPROVEMENT</option>
                        <option value="3">FAIR</option>
                        <option value="4">GOOD</option>
                        <option value="5">VERY GOOD</option>
                    </select>
                </td>
            </tr>
            <tr>
                <td>
                    Kakayahang magtago ng sikreto o kompidensyal na mga bagay tungkol sa mga katrabho.
                </td>
                <td>
                    <select name="criteria-2">
                        <option value="1" disabled selected>--SELECT RATING--</option>
                        <option value="1">POOR</option>
                        <option value="2">NEEDS IMPROVEMENT</option>
                        <option value="3">FAIR</option>
                        <option value="4">GOOD</option>
                        <option value="5">VERY GOOD</option>
                    </select>
                </td>
            </tr>
            <tr>
                <td>
                    Nangunguna/manamamatnubay sa mga katrabaho sa pagtatagumpay ng isang katrabahong nakataas o para sa pagtataguyod ng kapakanan ng grup.
                </td>
                <td>
                    <select name="criteria-2">
                        <option value="1" disabled selected>--SELECT RATING--</option>
                        <option value="1">POOR</option>
                        <option value="2">NEEDS IMPROVEMENT</option>
                        <option value="3">FAIR</option>
                        <option value="4">GOOD</option>
                        <option value="5">VERY GOOD</option>
                    </select>
                </td>
            </tr>
        </tbody>
    </table>
    <br /><br />
    <table>
        <thead>
            <tr id="heading-row">
                <th>III. Commitment and Compliance to Calfurn's Mission, Policies, Rules and Regulations (20%)</th>
                <th>Rating</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>
                    Hindi pa lumalabag sa mga probisyon na nakatala sa CRR and Policies
                </td>
                <td>
                    <select name="criteria-3">
                        <option value="1" disabled selected>--SELECT RATING--</option>
                        <option value="1">POOR</option>
                        <option value="2">NEEDS IMPROVEMENT</option>
                        <option value="3">FAIR</option>
                        <option value="4">GOOD</option>
                        <option value="5">VERY GOOD</option>
                    </select>
                </td>
            </tr>
            <tr>
                <td>
                    Lawak ng partisipasyon sa mga aktibidad, pagdiriwang at ibang mga pagtitipon ng kumpanya.
                </td>
                <td>
                    <select name="criteria-3">
                        <option value="1" disabled selected>--SELECT RATING--</option>
                        <option value="1">POOR</option>
                        <option value="2">NEEDS IMPROVEMENT</option>
                        <option value="3">FAIR</option>
                        <option value="4">GOOD</option>
                        <option value="5">VERY GOOD</option>
                    </select>
                </td>
            </tr>
            <tr>
                <td>
                    Hindi kailanman ginagamit ang kumpanya para sa pansariling kapakanan
                </td>
                <td>
                    <select name="criteria-3">
                        <option value="1" disabled selected>--SELECT RATING--</option>
                        <option value="1">POOR</option>
                        <option value="2">NEEDS IMPROVEMENT</option>
                        <option value="3">FAIR</option>
                        <option value="4">GOOD</option>
                        <option value="5">VERY GOOD</option>
                    </select>
                </td>
            </tr>
            <tr>
                <td>
                    Attendance
                    <br />
                    <ul>
                        <li>Saklaw nito ang pagdating sa tamang oras ng pagpasok at paglabas</li>
                        <li>Saklaw nito ang "Overtime" kung kinailangan (backlong, due dates, advance, work)</li>
                        <li>Saklaw nito ang bilang ng hindi paggamit ng kanya "leave of absence"</li>
                    </ul>
                </td>
                <td>
                    <select name="criteria-3">
                        <option value="1" disabled selected>--SELECT RATING--</option>
                        <option value="1">POOR</option>
                        <option value="2">NEEDS IMPROVEMENT</option>
                        <option value="3">FAIR</option>
                        <option value="4">GOOD</option>
                        <option value="5">VERY GOOD</option>
                    </select>
                </td>
            </tr>
        </tbody>
    </table>
    <br />
    <div class="two-column-content">
        <div class="cluster">
            <p class="sub-title">Comments:</p>
            <textarea placeholder="Evaluator's Comment" name="comment" class="full"></textarea>
        </div>
        <div class="cluster">
            <p class="sub-title">Noted By:</p>
            <select name="noted-by" class="full">
                <option value="-1" disabled selected>-- Select Employee --</option>
            </select>
        </div>
    </div>
<button type="submit" class="full">Save</button>
<div id="alert"></div>
</form>

@if (Account != null)
{
    <script>
        $(document).ready(() => {
            loadEmployees();
            loadNoters();
        });

        $("form").on("submit", (e) => {
            e.preventDefault();

            var form = new FormData($("form")[0]);
            form.append("values", JSON.stringify(getData()));

            $.ajax({
                url: "/Appraisal/Create",
                method: "POST",
                data: form,
                processData: false,
                contentType: false,
                success: (data) => {
                    if (data.error)
                        $("#alert").addClass('error');
                    else
                        $("#alert").addClass('success');

                    $("#alert").text(data.message);
                }
            })
        });

        function loadEmployees() {
            $.ajax({
                url: "/Appraisal/GetEmployees",
                method: "GET",
                success: (data) => {
                    data.employees.forEach((o, i, a) => {
                        let opt = $("<option value='" + o.EmployeeID + "'>" + o.Profile.FirstName + " " + o.Profile.MiddleName + " " + o.Profile.LastName + " " + "</option>");

                        $("select[name=employee]").append(opt);
                    })
                }
            })
        }

        function loadNoters() {
            $.ajax({
                url: "/Appraisal/GetEmployees",
                method: "GET",
                data: {
                    all: true,
                },
                success: (data) => {
                    data.employees.forEach((o, i, a) => {
                        let opt = $("<option value='" + o.EmployeeID + "'>" + o.Profile.FirstName + " " + o.Profile.MiddleName + " " + o.Profile.LastName + " " + "</option>");

                        $("select[name=noted-by]").append(opt);
                    })
                }
            })
        }

        function getData() {
            var data = {
                competence: [],
                interpersonal: [],
                commitment: []
            }

            $("select[name=criteria-1]").each((i, o) => {
                data.competence.push(($(o).val() != null) ? $(o).val() : 1);
            });

            $("select[name=criteria-2]").each((i, o) => {
                data.interpersonal.push(($(o).val() != null) ? $(o).val() : 1);
            });

            $("select[name=criteria-3]").each((i, o) => {
                data.commitment.push(($(o).val() != null) ? $(o).val() : 1);
            });

            return data;
        }
    </script>
}
